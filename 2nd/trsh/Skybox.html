<!doctype html>
<html lang="en">
<head>
	<title>Nature vs Nurture</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>

<script src="js/Three.js"></script>
<script src="js/OBJLoader.js"></script>
<script src="js/Detector.js"></script>
<script src="js/OrbitControls.js"></script>
<script src="js/Tween.js"></script>


<div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>
<script>

// standard global variables
var container, scene, camera, renderer, controls;

init();
animate();

function init()
{
	// SCENE
	scene = new THREE.Scene();
	// CAMERA //Shamelessly stolen from threejs examples.
	var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
	var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
	camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
	scene.add(camera);
	camera.position.set(0,150,400);
	camera.lookAt(scene.position);
	// RENDERER
	if ( Detector.webgl )
		renderer = new THREE.WebGLRenderer( {antialias:true} );
	else
		renderer = new THREE.CanvasRenderer();
	renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
	container = document.getElementById( 'ThreeJS' );
	container.appendChild( renderer.domElement );
	// CONTROLS //end Shamelessly stolen from threejs examples.
	controls = new THREE.OrbitControls( camera, renderer.domElement );
	// LIGHTs
	//Sun
	var light = new THREE.PointLight(0xffffff,100,400,2);
	light.position.set(-80,150,0);
	scene.add(light);
	//Volcano
	var volLight = new THREE.PointLight(0xff8800,300,500,2);//Gentle orange bask.
	volLight.position.set(0,200,200);
	scene.add(volLight);//Mostly illuminating the Dino.
	//Ambient
	var ambLight = new THREE.AmbientLight(0xffffff);
	scene.add(ambLight);



	//SKYBOX
	//Should probably blend the edges together a bit more.
	var imagePrefix = "images/skybox/";
	var directions  = ["px", "nx", "py", "ny", "pz", "nz"];
	var imageSuffix = ".jpg";
	var skyGeometry = new THREE.CubeGeometry( 500, 500, 500 );

	var materialArray = [];
	for (var i = 0; i < 6; i++)
		materialArray.push( new THREE.MeshBasicMaterial({
			map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
			side: THREE.BackSide
		}));
	var skyMaterial = new THREE.MeshFaceMaterial( materialArray );
	var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
	scene.add( skyBox );

	// TEXTURE MANAGER
	var manager = new THREE.LoadingManager();
	manager.onProgress = function ( item, loaded, total ) {
		console.log( item, loaded, total );
	};
	var texture = new THREE.Texture();

	var onProgress = function ( xhr ) {
		if ( xhr.lengthComputable ) {
			var percentComplete = xhr.loaded / xhr.total * 100;
			console.log( Math.round(percentComplete, 2) + '% downloaded' );
		}
	};

	var onError = function ( xhr ) {
	};

    /*  
	var loader = new THREE.ImageLoader( manager );
	//Textured dino. Dark texture, but a texture nonetheless.
	loader.load( 'raptor.jpg', function ( image ) {
		texture.image = image;
		texture.needsUpdate = true;

	} );
         */

	//DINOSAUR MODEL
	var loader = new THREE.OBJLoader( manager );
	//Is this like Momma Raptor, or just getting an easy dinner?
	loader.load( 'ship_triangle.obj', function ( object ) {

		object.traverse( function ( child ) {
			if ( child instanceof THREE.Mesh ) {
//				child.material.map = texture;
			}
		} );

		object.position.x = -10;
		object.position.y = -220;
		scene.add( object );

	}, onProgress, onError );

	//EGG 'MODELS'
	// set up the sphere vars for eggss
	var radius = 20;
	var	segments = 16;
	var	rings = 16;

		// create the sphere's material
		var sphereMaterial =
		  new THREE.MeshLambertMaterial(
			{
			  color: 0xd9b62b
		});

	// create a new mesh with
	// sphere geometry
	var egg1 = new THREE.Mesh(

	  new THREE.SphereGeometry(
		radius,
		segments,
		rings),

	  sphereMaterial);

	  egg1.position.x = -10;
	  egg1.position.y = -220;
	  egg1.scale.y *= 1.2;
	// add the egg to the scene
	scene.add(egg1);

	//Tween for shaking animation. Various stage of hatching.
	var startRotation1 = {x:-5, y:0, z:0};
	var endRotation1 = {x:10,y:0,z:0};
	var	tween1 = new TWEEN.Tween(startRotation1).to(endRotation1, 50);
	tween1.onUpdate(function(){
		egg1.rotation.set(startRotation1.x, startRotation1.y, startRotation1.z);
	});
	tween1.repeat( Infinity );
	tween1.start();


	//Add another one.
	var egg2 = new THREE.Mesh(

	new THREE.SphereGeometry(
		radius,
		segments,
		rings),

	sphereMaterial);
	egg2.position.x = -60;
	egg2.position.y = -220;
	egg2.position.z = -40;
	egg2.scale.y *= 1.2;
	scene.add(egg2);

	var startRotation2 = {x:10, y:5, z:0};
	var endRotation2 = {x:20,y:0,z:0};
	var	tween2 = new TWEEN.Tween(startRotation2).to(endRotation2, 70);
	tween2.onUpdate(function(){
		egg2.rotation.set(startRotation2.x, startRotation2.y, startRotation2.z);
	});
	tween2.repeat( Infinity );
	tween2.start();


	//Once More, With Feeling
	var egg3 = new THREE.Mesh(

	new THREE.SphereGeometry(
		radius,
		segments,
		rings),

	sphereMaterial);
	egg3.position.x = -60;
	egg3.position.y = -220;
	egg3.position.z = 60;
	egg3.scale.y *= 1.2;
	scene.add(egg3);

	//Tween
	var startRotation3 = {x:-30, y:0, z:0};//We're going to make these all slightly different so they don't all shake uniformly.
	var endRotation3 = {x:5,y:0,z:0};
	var	tween3 = new TWEEN.Tween(startRotation3).to(endRotation3, 60);
	tween3.onUpdate(function(){
		egg3.rotation.set(startRotation3.x, startRotation3.y, startRotation3.z);
	});
	tween3.repeat( Infinity );
	tween3.start();


	//There's probably a more efficient way to add all these.
	var egg4 = new THREE.Mesh(

	new THREE.SphereGeometry(
		radius,
		segments,
		rings),

	sphereMaterial);
	egg4.position.x = -120;
	egg4.position.y = -220;
	egg4.position.z = 10;
	egg4.scale.y *= 1.2;
	scene.add(egg4);

	//Tween
	var startRotation4 = {x:-5, y:5, z:0};//Babies shouldn't shake uniformly.
	var endRotation4 = {x:0,y:0,z:0};
	var	tween4 = new TWEEN.Tween(startRotation4).to(endRotation4, 500);
	tween4.onUpdate(function(){
		egg4.rotation.set(startRotation4.x, startRotation4.y, startRotation4.z);
	});
	tween4.repeat( Infinity );
	tween4.start();


	//TREE MODEL + Leaves. Ugly tree. Ugh.
	  var geometry = new THREE.BoxGeometry( 1, 1, 1 );
	  var triangleGeometry = new THREE.Geometry();
	  triangleGeometry.vertices.push(new THREE.Vector3(0,0,0));//Make a slanted triangle.
	  triangleGeometry.vertices.push(new THREE.Vector3(0,1,1));
	  triangleGeometry.vertices.push(new THREE.Vector3(1,0,0));
	  triangleGeometry.faces.push(new THREE.Face3(0,1,2));
	  triangleGeometry.faces.push(new THREE.Face3(2,1,0));
	  var leafMaterial = new THREE.MeshLambertMaterial( { color: 0x00ff00 } );
	  var bark = new THREE.MeshLambertMaterial( { color: 0x947110 } );

	  // trunkDummy is parent of trunk and leaf dummy
	  trunkDummy = new THREE.Object3D();

	  var trunk = new THREE.Mesh( geometry, bark );

	  trunkDummy.add(trunk);

	  leafDummy = new THREE.Object3D();
	  trunkDummy.add(leafDummy);

	 var leaf = new THREE.Mesh( triangleGeometry, leafMaterial );
	 leafDummy.add(leaf);
	 trunkDummy.position.set(-180, -200, -150);
	 leaf.position.set(3,25,-55);
	 leaf.scale.set(20,80,10);
	 leaf.rotation.set(70,0,0);

	 // new leafdummy for additional leaves
	 leafDummy2 = new THREE.Object3D();
	 trunkDummy.add(leafDummy2);
	 leafDummy2.position.set(0,10,0);

	 var leaf2 = new THREE.Mesh( triangleGeometry, leafMaterial );
	 leafDummy2.rotation.set(0,90,0);//So the leaf can face a different direction.
	 leafDummy2.add(leaf2);
	 leaf2.position.set(3,15,-55);
	 leaf2.scale.set(20,80,10);
	 leaf2.rotation.set(70,0,0);

	 // new leafdummy for additional leaves
	 leafDummy3 = new THREE.Object3D();
	 trunkDummy.add(leafDummy3);
	 leafDummy3.position.set(0,10,0);

	 var leaf3 = new THREE.Mesh( triangleGeometry, leafMaterial );
	 leafDummy3.rotation.set(0,180,0);
	 leafDummy3.add(leaf3);
	 leaf3.position.set(3,15,-55);
	 leaf3.scale.set(20,80,10);
	 leaf3.rotation.set(70,0,0);

	 // new leafdummy for additional leaves
	 leafDummy4 = new THREE.Object3D();
	 trunkDummy.add(leafDummy4);
	 leafDummy4.position.set(0,10,0);

	 var leaf4 = new THREE.Mesh( triangleGeometry, leafMaterial );
	 leafDummy4.rotation.set(0,210,0);
	 leafDummy4.add(leaf4);
	 leaf4.position.set(3,15,-55);
	 leaf4.scale.set(20,80,10);
	 leaf4.rotation.set(70,0,0);

	//Actually a pretty short tree. Maybe it's young.
	trunk.scale.set(20, 100, 20);
	scene.add( trunkDummy );

}

function animate()
{
    requestAnimationFrame( animate );
	render();
	update();
}

function update()
{
	controls.update();//Object orbity stuff. From threejs website.
}

function render()
{
	TWEEN.update();//Shaking animation paths.
	renderer.render( scene, camera );
}

</script>

</body>
</html>
